<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Meu Casino</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #3a3a5c);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
        }

        h1 {
            color: #ffd700;
            text-shadow: 2px 2px #000;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: none;
            width: 200px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            border: none;
            background-color: #ff6b6b;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background-color: #ff4757;
            transform: scale(1.05);
        }

        #user-info, #auth-container {
            background-color: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            width: 300px;
            text-align: center;
        }

        #saldo {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #00ff99;
        }

        #resultado {
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.1em;
        }

        #historico {
            list-style: none;
            padding-left: 0;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        #historico li {
            background-color: rgba(255,255,255,0.1);
            margin-bottom: 3px;
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ° Meu Casino ðŸŽ°</h1>

    <!-- Login / Registro -->
    <div id="auth-container">
        <input type="email" id="email" placeholder="Email"><br>
        <input type="password" id="senha" placeholder="Senha"><br>
        <button id="btn-registrar">Registrar</button>
        <button id="btn-login">Login</button>
    </div>

    <!-- Ãrea do jogador -->
    <div id="user-info" style="display:none;">
        <div id="saldo">Saldo: 0 coins</div>
        <button id="apostar">Apostar 100 coins</button>
        <div id="resultado"></div>
        <h3>HistÃ³rico de Apostas</h3>
        <ul id="historico"></ul>
        <button id="btn-logout">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDw0_MsxvRvVhsgSWvzMrVX3sTlmG2ALcg",
            authDomain: "bigbetroyal-c1fb5.firebaseapp.com",
            projectId: "bigbetroyal-c1fb5",
            storageBucket: "bigbetroyal-c1fb5.firebasestorage.app",
            messagingSenderId: "16493079216",
            appId: "1:16493079216:web:ee35f501c6b6bb36376975"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function criarDocumentoUsuario(uid) {
            await setDoc(doc(db, "users", uid), { saldo: 1000 });
        }

        async function carregarSaldo(uid) {
            const docRef = doc(db, "users", uid);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                document.getElementById("saldo").textContent = `Saldo: ${docSnap.data().saldo} coins`;
            } else {
                await criarDocumentoUsuario(uid);
                document.getElementById("saldo").textContent = `Saldo: 1000 coins`;
            }
            await carregarHistorico(uid);
        }

        async function atualizarSaldo(uid, novoSaldo) {
            await updateDoc(doc(db, "users", uid), { saldo: novoSaldo });
            document.getElementById("saldo").textContent = `Saldo: ${novoSaldo} coins`;
        }

        async function adicionarAposta(uid, valor, resultado) {
            await addDoc(collection(db, "users", uid, "historico"), {
                valor: valor,
                resultado: resultado,
                data: new Date()
            });
            await carregarHistorico(uid);
        }

        async function carregarHistorico(uid) {
            const historicoEl = document.getElementById("historico");
            historicoEl.innerHTML = "";
            const q = query(collection(db, "users", uid, "historico"), orderBy("data", "desc"));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement("li");
                li.textContent = `${data.data.toDateString()} - Aposta: ${data.valor} coins - ${data.resultado}`;
                historicoEl.appendChild(li);
            });
        }

        const emailInput = document.getElementById("email");
        const senhaInput = document.getElementById("senha");
        const btnRegistrar = document.getElementById("btn-registrar");
        const btnLogin = document.getElementById("btn-login");
        const btnLogout = document.getElementById("btn-logout");
        const authContainer = document.getElementById("auth-container");
        const userInfo = document.getElementById("user-info");
        const btnApostar = document.getElementById("apostar");

        btnRegistrar.addEventListener("click", async () => {
            const email = emailInput.value.trim();
            const senha = senhaInput.value;
            if (!email || !senha) return alert("Preencha email e senha!");
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                await criarDocumentoUsuario(userCredential.user.uid);
            } catch (error) {
                alert(error.message);
            }
        });

        btnLogin.addEventListener("click", async () => {
            const email = emailInput.value.trim();
            const senha = senhaInput.value;
            if (!email || !senha) return alert("Preencha email e senha!");
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, senha);
                carregarSaldo(userCredential.user.uid);
            } catch (error) {
                alert(error.message);
            }
        });

        btnLogout.addEventListener("click", async () => {
            await signOut(auth);
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.style.display = "none";
                userInfo.style.display = "block";
                carregarSaldo(user.uid);
            } else {
                authContainer.style.display = "block";
                userInfo.style.display = "none";
            }
        });

        btnApostar.addEventListener("click", async () => {
            const user = auth.currentUser;
            if (!user) return alert("VocÃª precisa estar logado para apostar!");
            try {
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);
                if (!docSnap.exists()) return alert("Documento do usuÃ¡rio nÃ£o encontrado!");

                let saldo = docSnap.data().saldo;
                if (saldo < 100) return alert("Saldo insuficiente!");

                saldo -= 100;
                const ganhou = Math.random() < 0.5;
                if (ganhou) saldo += 200;

                await atualizarSaldo(user.uid, saldo);
                await adicionarAposta(user.uid, 100, ganhou ? "Ganhou" : "Perdeu");

                document.getElementById("resultado").textContent = ganhou ? "ðŸŽ‰ VocÃª ganhou!" : "ðŸ’” VocÃª perdeu!";
            } catch (error) {
                console.error(error);
                alert("Erro ao apostar: " + error.message);
            }
        });

    </script>
</body>
</html>
